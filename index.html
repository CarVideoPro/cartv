<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Car Video Pro TV</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    :root {
        --player-height: 55px;
        --category-bar-height: 40px;
    }

    /* TEMA RENK DEĞİŞKENLERİ */
    [data-theme='default'] {
        --bg-primary: #000;
        --bg-secondary: #121212;
        --bg-tertiary: #1e1e1e;
        --bg-hover: #2c2c2c;
        --border-color: #333;
        --accent-color: #3366cc;
        --accent-color-darker: #252a3a;
        --text-primary: #fff;
        --text-secondary: #aaa;
        --epg-color: turquoise;
    }
    [data-theme='forest'] {
        --bg-primary: #0a0a0a;
        --bg-secondary: #1a2e24;
        --bg-tertiary: #2d4036;
        --bg-hover: #3c5246;
        --border-color: #444;
        --accent-color: #4CAF50; /* Yeşil */
        --accent-color-darker: #388E3C;
        --text-primary: #e0e0e0;
        --text-secondary: #b0b0b0;
        --epg-color: #81C784;
    }
    [data-theme='royal'] {
        --bg-primary: #0d0c1d;
        --bg-secondary: #1c1a3a;
        --bg-tertiary: #2e2c5b;
        --bg-hover: #3c3a6d;
        --border-color: #4a477a;
        --accent-color: #9C27B0; /* Mor */
        --accent-color-darker: #7B1FA2;
        --text-primary: #f3e5f5;
        --text-secondary: #ce93d8;
        --epg-color: #ba68c8;
    }
    [data-theme='sunset'] {
        --bg-primary: #1b120f;
        --bg-secondary: #3d2c26;
        --bg-tertiary: #5d4037;
        --bg-hover: #6d4c41;
        --border-color: #4e342e;
        --accent-color: #FF5722; /* Turuncu */
        --accent-color-darker: #E64A19;
        --text-primary: #fff3e0;
        --text-secondary: #ffccbc;
        --epg-color: #ff8a65;
    }
    [data-theme='steel'] {
        --bg-primary: #121212;
        --bg-secondary: #222222;
        --bg-tertiary: #333333;
        --bg-hover: #444444;
        --border-color: #555;
        --accent-color: #757575; /* Gri */
        --accent-color-darker: #616161;
        --text-primary: #f5f5f5;
        --text-secondary: #bdbdbd;
        --epg-color: #9e9e9e;
    }


    * { box-sizing: border-box; }
    html, body {
      margin: 0; height: 100%; background: var(--bg-primary); font-family: sans-serif; overflow: hidden;
      color: var(--text-primary);
      font-size: 14px;
    }
    #app {
      display: flex; flex-direction: column; height: 100%;
      padding-bottom: calc(var(--player-height) + var(--category-bar-height));
    }
    #main {
      display: flex; flex: 1; overflow: hidden;
    }
    #channels {
      flex: 0 0 260px;
      background: var(--bg-secondary);
      border-right: 2px solid var(--border-color);
      overflow-y: auto;
      padding: 8px;
      display: flex; flex-direction: column; gap: 6px;
    }
    #previewArea {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        background: var(--bg-primary);
        overflow: hidden;
    }
    #previewPlaceholder {
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        gap: 15px;
        color: #555;
        height: 100%;
        cursor: default;
    }
    #previewPlaceholder h2 { font-size: 1.5em; }
    #previewPlaceholder p { font-size: 1em; }

    #previewVideo {
        width: 100%; height: 100%;
        background: #000; object-fit: contain; display: none;
        cursor: pointer;
    }
    
    #groups {
        position: fixed;
        bottom: var(--player-height); left: 0; width: 100%; height: var(--category-bar-height);
        background: var(--bg-secondary);
        border-top: 1px solid var(--border-color);
        display: flex; overflow-x: auto; z-index: 1000;
        scrollbar-width: thin; scrollbar-color: var(--accent-color) var(--bg-secondary);
    }
    #groups::-webkit-scrollbar { height: 6px; }
    #groups::-webkit-scrollbar-track { background: var(--bg-secondary); }
    #groups::-webkit-scrollbar-thumb { background-color: var(--accent-color); border-radius: 10px; }

    .group {
      padding: 0 18px; cursor: pointer; background: transparent;
      border-right: 1px solid var(--border-color);
      line-height: var(--category-bar-height);
      white-space: nowrap; flex-shrink: 0;
      transition: background-color 0.2s;
    }
    .group:hover, .group.active {
      background: var(--accent-color);
    }

    .channel {
      display: flex; align-items: center; gap: 8px;
      background: var(--bg-tertiary);
      border-radius: 6px; padding: 8px; cursor: pointer;
      border: 1px solid transparent;
      transition: all 0.2s;
    }
    .channel:hover { background: var(--bg-hover); }
    .channel.active { border-color: var(--accent-color); background: var(--accent-color-darker); }
    .channel img { width: 38px; height: 38px; object-fit: contain; }
    .epg-title { color: var(--epg-color); font-size: 0.9em; }

    #playerContainer {
      position: fixed; bottom: 0; left: 0; width: 100%; height: var(--player-height); background: var(--bg-secondary);
      display: flex; z-index: 999; align-items: center; padding: 0 15px;
      border-top: 2px solid var(--border-color);
      justify-content: space-between;
      gap: 20px;
    }
    .player-info { display: flex; align-items: center; gap: 12px; }
    .player-info img { width: 40px; height: 40px; object-fit: contain; border-radius: 5px; background-color: #d8d8d8; }
    .player-text .title { font-size: 1em; font-weight: bold; }
    .player-text .telegram { font-size: 0.85em; color: var(--text-secondary); }
    
    .player-controls { 
        display: flex; 
        align-items: center; 
        gap: 15px; 
        flex-grow: 1; /* Ortalamak için eklendi */
        justify-content: center; /* Ortalamak için eklendi */
    }

    .control-btn {
      background: var(--bg-tertiary); color: var(--text-primary); 
      border: 1px solid var(--border-color);
      border-bottom: 3px solid var(--border-color);
      font-size: 14px; font-weight: bold;
      border-radius: 8px; cursor: pointer;
      height: 38px;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.1s ease-in-out;
      padding: 0 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      visibility: hidden; /* Başlangıçta gizli */
    }
    .control-btn:hover { 
        background: var(--bg-hover); 
        transform: translateY(-1px);
        box-shadow: 0 3px 6px rgba(0,0,0,0.3);
    }
    .control-btn:active {
        transform: translateY(1px);
        border-bottom-width: 1px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }


    #themeSelector {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .theme-swatch {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid var(--border-color);
        transition: transform 0.2s, border-color 0.2s;
    }
    .theme-swatch:hover { transform: scale(1.1); }
    .theme-swatch.active {
        border-color: var(--text-primary);
        box-shadow: 0 0 5px var(--text-primary);
    }

  </style>
</head>
<body data-theme="default">
  <div id="app">
    <div id="main">
      <div id="channels"></div>
      <div id="previewArea">
        <div id="previewPlaceholder">
          <h1>Car Video Pro TV</h1>
          <h2>Tam Ekran için 2 kez Tıklayın</h2>
          <p>Lütfen bir kategori seçip kanala tıklayınız.</p>
        </div>
        <video id="previewVideo" autoplay playsinline></video>
      </div>
    </div>
  </div>

  <div id="groups"></div>

  <div id="playerContainer">
    <div class="player-info">
      <img id="playerLogo" src="" alt="logo" style="visibility: hidden;">
      <div class="player-text">
        <div class="title">Car Video Pro</div>
        <div class="telegram">Telegram : t.me/car_video_pro</div>
      </div>
    </div>
    <div class="player-controls">
      <button class="control-btn" onclick="changeChannel(-1)">◄ Geri</button>
      <button class="control-btn" onclick="changeChannel(1)">İleri ►</button>
    </div>
    <div id="themeSelector"></div> 
  </div>

  <script>
    const m3uUrl = "https://raw.githubusercontent.com/ghokun/tv/main/bin/playlist.m3u";
    const epgUrl = "https://raw.githubusercontent.com/ghokun/tv/main/bin/guide.xml";

    const G_UI = {
        groups: document.getElementById("groups"),
        channels: document.getElementById("channels"),
        preview: {
            placeholder: document.getElementById("previewPlaceholder"),
            video: document.getElementById("previewVideo")
        },
        player: {
            container: document.getElementById("playerContainer"),
            logo: document.getElementById("playerLogo"),
            controls: document.querySelectorAll('.control-btn')
        },
        themeSelector: document.getElementById("themeSelector")
    };
    
    const themes = {
        'default': { name: 'Varsayılan', color: '#3366cc' },
        'forest': { name: 'Orman', color: '#4CAF50' },
        'royal': { name: 'Kraliyet', color: '#9C27B0' },
        'sunset': { name: 'Gün Batımı', color: '#FF5722' },
        'steel': { name: 'Çelik', color: '#757575' }
    };
    
    const extraMusicChannels = [
        { name: "Number 1 TV", logo: "https://i.ibb.co/sybLTBG/nr1.png", group: "Müzik Ekstra", epgId: "Number1TV.tr", url: "https://b01c02nl.mediatriple.net/videoonlylive/mtkgeuihrlfwlive/u_stream_5c9e17cd6360b_1/playlist.m3u8" },
        { name: "KRAL POP", logo: "https://i.ibb.co/vk0bKz0/kral-pop.png", group: "Müzik Ekstra", epgId: "Kral.Pop.Radyo.tr", url: "http://dygvideo.dygdigital.com/live/hls/kralpop" },
        { name: "Number 1 Ask", logo: "https://i.ibb.co/5cJ0KtQ/nr1-ask.png", group: "Müzik Ekstra", epgId: "Number1Ask.tr", url: "https://b01c02nl.mediatriple.net/videoonlylive/mtkgeuihrlfwlive/u_stream_5c9e18f9cea15_1/playlist.m3u8" },
        { name: "Number 1 Damar", logo: "https://i.ibb.co/2yCF7ms/nr1-damar.png", group: "Müzik Ekstra", epgId: "Number1Damar.tr", url: "https://b01c02nl.mediatriple.net/videoonlylive/mtkgeuihrlfwlive/u_stream_5c9e198784bdc_1/playlist.m3u8" },
        { name: "Number 1 Dance", logo: "https://i.ibb.co/kXFSFTN/nr1-dance.png", group: "Müzik Ekstra", epgId: "Number1Dance.tr", url: "https://b01c02nl.mediatriple.net/videoonlylive/mtkgeuihrlfwlive/u_stream_5c9e2aa8acf44_1/playlist.m3u8" },
        { name: "NR1 FASHION ONE", logo: "https://i.ibb.co/HV0x9JZ/fashion-one.png", group: "Müzik Ekstra", epgId: "", url: "http://b01c02nl.mediatriple.net/videoonlylive/mtkgeuihrlfwlive/u_stream_5c9e2ee6997cb_1/playlist.m3u8" },
        { name: "TRT Muzik", logo: "https://i.ibb.co/4gbPpzC/trt-muzik.png", group: "Müzik Ekstra", epgId: "TRTMuzik.tr", url: "https://tv-trtmuzik.medya.trt.com.tr/master_720.m3u8" },
        { name: "PowerTurk TV", logo: "https://i.ibb.co/xXcBD2C/powerturk.png", group: "Müzik Ekstra", epgId: "PowerTurkTV.tr", url: "https://livetv.powerapp.com.tr/powerturkTV/powerturkhd.smil/chunks.m3u8" },
        { name: "Power TV", logo: "https://i.ibb.co/JrXDQJy/power-tv.png", group: "Müzik Ekstra", epgId: "PowerTV.tr", url: "https://livetv.powerapp.com.tr/powerTV/powerhd.smil/chunks.m3u8" },
        { name: "POWER TURK TAPTAZE", logo: "https://i.ibb.co/F5K5xs9/powerturk-taptaze.png", group: "Müzik Ekstra", epgId: "", url: "http://livetv.powerapp.com.tr/pturktaptaze/taptaze.smil/playlist.m3u8" },
        { name: "POWER DANCE", logo: "https://i.ibb.co/5hwZ7xw/power-dance.png", group: "Müzik Ekstra", epgId: "", url: "https://listen.powerapp.com.tr/dance/dance.smil/chunks.m3u8" },
        { name: "POWER LOVE", logo: "https://i.ibb.co/bJL1VnX/power-love.png", group: "Müzik Ekstra", epgId: "", url: "https://listen.powerapp.com.tr/plove/love.smil/chunks.m3u8" },
        { name: "POWER TURK AKUSTIK", logo: "https://i.ibb.co/XFY7dCW/powerturk-akustik.png", group: "Müzik Ekstra", epgId: "", url: "https://listen.powerapp.com.tr/pturkakustik/akustik.smil/chunks.m3u8" },
        { name: "POWER TURK SLOW", logo: "https://i.ibb.co/R4pcKqK/powerturk-slow.png", group: "Müzik Ekstra", epgId: "", url: "https://listen.powerapp.com.tr/pturkslow/slow.smil/chunks.m3u8" }
    ];

    const newChannels = [
        // Ulusal
        { name: 'TRT 1', url: 'https://tv-trt1.medya.trt.com.tr/master_720.m3u8', logo: 'https://upload.wikimedia.org/wikipedia/commons/4/4a/TRT1_Logo_2020-2021.jpg?20200512090317', group: 'Ulusal', epgId: '' },
        { name: 'ATV HD', url: 'https://rnttwmjcin.turknet.ercdn.net/lcpmvefbyo/atv/atv.m3u8', logo: 'https://raw.githubusercontent.com/ghokun/tv/main/bin/logo/ATV.tr.png', group: 'Ulusal', epgId: '' },
        { name: 'ATV HD 2', url: 'https://sultanweb.info/TurkSATB.php?ID=13351', logo: 'https://raw.githubusercontent.com/ghokun/tv/main/bin/logo/ATV.tr.png', group: 'Ulusal', epgId: '' },
        { name: 'KANAL D', url: 'https://demiroren-live.daioncdn.net/kanald/kanald_1080p.m3u8?app=kanald_web&ce=3', logo: 'https://i.ibb.co/hf2mSz5/kanal-d.png', group: 'Ulusal', epgId: '' },
        { name: 'STAR TV', url: 'https://dogus-live.daioncdn.net/startv/startv_720p.m3u8', logo: 'https://i.ibb.co/hY3Z8zx/star-tv.png', group: 'Ulusal', epgId: '' },
        { name: 'SHOW TV', url: 'https://ciner-live.daioncdn.net/showtv/showtv_1080p.m3u8', logo: 'https://i.ibb.co/Rv0rWhZ/show.png', group: 'Ulusal', epgId: '' },
        { name: 'NOW', url: 'https://raw.githubusercontent.com/exfair/tv/refs/heads/main/code/now.m3u8', logo: 'https://images.seeklogo.com/logo-png/51/1/now-tv-turkey-logo-png_seeklogo-519520.png', group: 'Ulusal', epgId: '' },
        { name: 'TV 8', url: 'https://tv8-live.daioncdn.net/tv8/tv8_1080p.m3u8', logo: 'https://i.ibb.co/Kr5SFY1/tv8.png', group: 'Ulusal', epgId: '' },
        { name: 'EURO D', url: 'https://thema-vivekanald-rakuten.amagi.tv/playlist.m3u8', logo: 'https://i.ibb.co/jMQTJmh/euro-d.png', group: 'Ulusal', epgId: '' },
        { name: 'TV 8 INT', url: 'https://tv8-live.daioncdn.net/tv8/tv8.m3u8', logo: 'https://i.ibb.co/ykSLX8Q/tv8-int.png', group: 'Ulusal', epgId: '' },
        { name: 'TRT 2', url: 'https://tv-trt2.medya.trt.com.tr/master_720.m3u8', logo: 'https://i.ibb.co/m5T5bQxB/Ads-z-tasar-m-2.png', group: 'Ulusal', epgId: '' },
        { name: 'TRT TURK', url: 'https://tv-trtturk.medya.trt.com.tr/master_720.m3u8', logo: 'https://i.ibb.co/cSNfr17C/trturk.png', group: 'Ulusal', epgId: '' },
        { name: 'SHOW MAX HD', url: 'https://live-cdn-65984.varplaycdn.cfd/showmax/index.m3u8', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Show_MAX_logo.svg/2048px-Show_MAX_logo.svg.png', group: 'Ulusal', epgId: '' },
        { name: 'KANAL 7', url: 'https://kanal7-live.daioncdn.net/kanal7/kanal7_1080p.m3u8', logo: 'https://i.ibb.co/DPVDgvqn/Ads-z-tasar-m-1.png', group: 'Ulusal', epgId: '' },
        { name: 'KANAL 7 AVRUPA', url: 'https://livetv.radyotvonline.net/kanal7live/kanal7avr/chunklist.m3u8', logo: 'https://i.ibb.co/xq3rRJV5/Ads-z-tasar-m-3.png', group: 'Ulusal', epgId: '' },
        { name: 'BEYAZ TV', url: 'https://beyaztv-live.daioncdn.net/beyaztv/beyaztv.m3u8', logo: 'https://i.ibb.co/JWMb2kcp/Ads-z-tasar-m-4.png', group: 'Ulusal', epgId: '' },
        { name: 'TEVE 2', url: 'https://demiroren-live.daioncdn.net/teve2/teve2.m3u8', logo: 'https://i.ibb.co/JRpJc2P/teve2.png', group: 'Ulusal', epgId: '' },
        { name: '360', url: 'https://turkmedya-live.ercdn.net/tv360/tv360_720p.m3u8', logo: 'https://i.ibb.co/s3gJCGL/360.png', group: 'Ulusal', epgId: '' },
        { name: 'TV 4', url: 'https://turkmedya-live.ercdn.net/tv4/tv4_720p.m3u8', logo: 'https://i.ibb.co/5XGy07B3/Ads-z-tasar-m-5.png', group: 'Ulusal', epgId: '' },
        { name: 'WOMAN TV', url: 'https://s01.webcaster.cloud/wmtv/live_1080p.m3u8', logo: 'https://i.ibb.co/bHTjDyk/woman-tv.png', group: 'Ulusal', epgId: '' },
        { name: 'TIVI 6', url: 'https://live.artidijitalmedya.com/artidijital_tivi6/tivi6/playlist.m3u8', logo: 'https://i.ibb.co/2Y3YGXg4/Ads-z-tasar-m-6.png', group: 'Ulusal', epgId: '' },
        { name: 'BIR TV', url: 'https://edge1.socialsmart.tv/birtv/bant1/playlist.m3u8', logo: 'https://i.ibb.co/dDdPMWq/birtv.png', group: 'Ulusal', epgId: '' },
        { name: 'CINE1', url: 'https://live.artidijitalmedya.com/artidijital_cine1/cine1/playlist.m3u8', logo: 'https://i.ibb.co/zhxTBMR/cine1.png', group: 'Ulusal', epgId: '' },
        { name: 'LIFE TV', url: 'https://live.artidijitalmedya.com/artidijital_lifetv/lifetv/playlist.m3u8', logo: 'https://i.ibb.co/9hCVNks/life-tv.png', group: 'Ulusal', epgId: '' },
        // Spor
        { name: 'TRT SPOR', url: 'https://tv-trtspor1.medya.trt.com.tr/master_720.m3u8', logo: 'https://i.ibb.co/WxD4PLG/trt-spor.png', group: 'Spor', epgId: '' },
        { name: 'TRT SPOR YILDIZ', url: 'https://tv-trtspor2.medya.trt.com.tr/master_720.m3u8', logo: 'https://i.ibb.co/YRgKcDn/trt-spor-yildiz.png', group: 'Spor', epgId: '' },
        { name: 'TV 8.5', url: 'https://tv8-live.daioncdn.net/tv8bucuk/tv8bucuk_1080p.m3u8', logo: 'https://i.ibb.co/6PRYHdW/tv85.png', group: 'Spor', epgId: '' },
        { name: 'A SPOR', url: 'https://live-cdn-65984.varplaycdn.cfd/aspor/index.m3u8', logo: 'https://i.ibb.co/rwnrgFV/a-spor.png', group: 'Spor', epgId: '' },
        { name: 'S SPORTS TV', url: 'https://live.sportstv.com.tr/hls/low/sportstv_hd/index.m3u8', logo: 'https://i.ibb.co/Q7qK4qQj/Ads-z-tasar-m-16.png', group: 'Spor', epgId: '' },
        { name: 'FB TV', url: 'https://1hskrdto.rocketcdn.com/fenerbahcetv.smil/playlist.m3u8', logo: 'https://i.ibb.co/315SYpK/fb-tv.png', group: 'Spor', epgId: '' },
        { name: 'TJK TV', url: 'https://tjktv-live.tjk.org/tjktv_1080p.m3u8', logo: 'https://i.ibb.co/PrkXrRn/tjk-tv.png', group: 'Spor', epgId: '' },
        { name: 'TJK TV YURT DISI', url: 'https://tjktv-live.tjk.org/tjktv2/tjktv2_1080p.m3u8', logo: 'https://i.ibb.co/PrkXrRn/tjk-tv.png', group: 'Spor', epgId: '' },
        // Belgesel
        { name: 'TRT BELGESEL', url: 'https://tv-trtbelgesel.medya.trt.com.tr/master_720.m3u8', logo: 'https://i.ibb.co/MkvY46q/trt-belgesel.png', group: 'Belgesel', epgId: '' },
        { name: 'DMAX', url: 'https://dogus-live.daioncdn.net/dmax/dmax_720p.m3u8', logo: 'https://i.ibb.co/1LH22gK/dmax.png', group: 'Belgesel', epgId: '' },
        { name: 'TLC', url: 'https://dogus-live.daioncdn.net/tlc/tlc_720p.m3u8', logo: 'https://i.ibb.co/Cm1nYZK/tlc.png', group: 'Belgesel', epgId: '' },
        { name: 'TRT AVAZ', url: 'https://tv-trtavaz.medya.trt.com.tr/master_720.m3u8', logo: 'https://i.ibb.co/Mnhmxsn/trt-avaz.png', group: 'Belgesel', epgId: '' },
        { name: 'TARİH TV HD', url: 'https://live-cdn-65984.varplaycdn.cfd/tarihtv/index.m3u8', logo: 'https://upload.wikimedia.org/wikipedia/commons/5/5a/Tarih-tv-logo-siyah-1080x1080.png', group: 'Belgesel', epgId: '' },
        // Ulusal Haber
        { name: 'TRT HABER', url: 'https://tv-trthaber.medya.trt.com.tr/master_720.m3u8', logo: 'https://i.ibb.co/LzcNGmm8/unnamed.png', group: 'Ulusal Haber', epgId: '' },
        { name: 'HABER GLOBAL', url: 'https://tv.ensonhaber.com/haberglobal/haberglobal_720p.m3u8', logo: 'https://i.ibb.co/21zzHPgT/Ads-z-tasar-m-7.png', group: 'Ulusal Haber', epgId: '' },
        { name: 'BLOOMBERG HT', url: 'https://ciner-live.daioncdn.net/bloomberght/bloomberght_720p.m3u8', logo: 'https://i.ibb.co/0RhF7QQB/Ads-z-tasar-m-8.png', group: 'Ulusal Haber', epgId: '' },
        { name: 'HABERTURK', url: 'https://ciner-live.daioncdn.net/haberturktv/haberturktv_1080p.m3u8', logo: 'https://i.ibb.co/Q79Lh4Cb/Ads-z-tasar-m-9.png', group: 'Ulusal Haber', epgId: '' },
        { name: '24', url: 'https://mn-nl.mncdn.com/kanal24/kanal24.smil/chunklist_b896000.m3u8', logo: 'https://i.ibb.co/tHQpWvn/24.png', group: 'Ulusal Haber', epgId: '' },
        { name: 'TVNET', url: 'https://mn-nl.mncdn.com/tvnet/tvnet/playlist.m3u8', logo: 'https://i.ibb.co/RpyvJDrM/Ads-z-tasar-m-12.png', group: 'Ulusal Haber', epgId: '' },
        { name: 'AKIT TV', url: 'https://akittv-live.ercdn.net/akittv/akittv_720p.m3u8', logo: 'https://i.ibb.co/3mPpV9kp/Ads-z-tasar-m-11.png', group: 'Ulusal Haber', epgId: '' },
        { name: 'BENGU TURK', url: 'https://tv.ensonhaber.com/benguturk/benguturk_720p.m3u8', logo: 'https://i.ibb.co/CHWhMvQ/bengu-turk.png', group: 'Ulusal Haber', epgId: '' },
        { name: 'TGRT HABER HD', url: 'https://canli.tgrthaber.com/tgrt.m3u8', logo: 'https://i.ibb.co/KYdPPbs/Ads-z-tasar-m-13.png', group: 'Ulusal Haber', epgId: '' },
        { name: 'TURKHABER', url: 'https://edge1.socialsmart.tv/turkhaber/bant1/playlist.m3u8', logo: 'https://i.ibb.co/1JMFDj8X/Ads-z-tasar-m-14.png', group: 'Ulusal Haber', epgId: '' },
        // Müzik
        { name: 'NR1', url: 'https://b01c02nl.mediatriple.net/videoonlylive/mtkgeuihrlfwlive/u_stream_5c9e17cd6360b_1/playlist.m3u8', logo: 'https://i.ibb.co/YBqnDxdN/Ads-z-tasar-m-17.png', group: 'Müzik', epgId: '' },
        { name: 'POWER TURK', url: 'https://livetv.powerapp.com.tr/powerturkTV/powerturkhd.smil/playlist.m3u8', logo: 'https://i.ibb.co/xXcBD2C/powerturk.png', group: 'Müzik', epgId: '' },
        // Çocuk & Eğitim
        { name: 'TRT ÇOCUK', url: 'https://tv-trtcocuk.medya.trt.com.tr/master_720.m3u8', logo: 'https://i.ibb.co/mbvwYMB/trt-cocuk.png', group: 'Çocuk & Eğitim', epgId: '' },
        { name: 'TRT Diyanet Çocuk', url: 'https://tv-trtdiyanetcocuk.medya.trt.com.tr/master.m3u8', logo: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTNwBQtkeuk0a1Ofxhin7lGP_VtWNecIwOsSA&s', group: 'Çocuk & Eğitim', epgId: '' },
        { name: 'MinikaGo', url: 'https://rnttwmjcin.turknet.ercdn.net/lcpmvefbyo/minikago/minikago_720p.m3u8', logo: 'https://i.ibb.co/2ZwxWr0/minika-go.png', group: 'Çocuk & Eğitim', epgId: '' },
        { name: 'Minika Çocuk', url: 'https://rnttwmjcin.turknet.ercdn.net/lcpmvefbyo/minikago_cocuk/minikago_cocuk_720p.m3u8', logo: 'https://i.ibb.co/S794c6W/minika-cocuk.png', group: 'Çocuk & Eğitim', epgId: '' },
        { name: 'Disney JR HD', url: 'https://saran-live.ercdn.net/disneyjunior/index.m3u8', logo: 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/2024_Disney_Jr._Logo.svg/1024px-2024_Disney_Jr._Logo.svg.png', group: 'Çocuk & Eğitim', epgId: '' }
    ];

    let allChannels = [], epgData = {}, currentChannelList = [], hls;
    let currentChannelIndex = -1;

    function applyTheme(themeName) {
        document.body.dataset.theme = themeName;
        localStorage.setItem('iptvTheme', themeName);
        document.querySelectorAll('.theme-swatch').forEach(swatch => {
            swatch.classList.toggle('active', swatch.dataset.theme === themeName);
        });
    }

    function createThemeSelector() {
        for (const [key, theme] of Object.entries(themes)) {
            const swatch = document.createElement('div');
            swatch.className = 'theme-swatch';
            swatch.dataset.theme = key;
            swatch.title = theme.name;
            swatch.style.backgroundColor = theme.color;
            swatch.onclick = () => applyTheme(key);
            G_UI.themeSelector.appendChild(swatch);
        }
    }

    async function fetchM3U() {
      try {
        const res = await fetch(m3uUrl);
        const text = await res.text();
        const lines = text.split(/\r?\n/);
        let current = null;
        const m3uChannels = [];
        for (const line of lines) {
          if (line.startsWith("#EXTINF")) {
            const name = line.match(/,(.*)$/)?.[1].trim();
            const logo = line.match(/tvg-logo="(.*?)"/)?.[1];
            const group = line.match(/group-title="(.*?)"/)?.[1];
            const id = line.match(/tvg-id="(.*?)"/)?.[1];
            current = { name, logo, group: group || "Diğer", epgId: id };
          } else if (current && line.startsWith("http")) {
            current.url = line.trim();
            m3uChannels.push(current);
            current = null;
          }
        }
        return m3uChannels;
      } catch (error) {
        console.error("M3U verisi alınamadı:", error);
        return [];
      }
    }

    async function fetchEPG() {
      try {
        const res = await fetch(epgUrl);
        const xml = await res.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(xml, "text/xml");
        const progs = doc.querySelectorAll("programme");
        const now = new Date();
        for (const p of progs) {
          const chan = p.getAttribute("channel");
          const start = parseEPGDate(p.getAttribute("start"));
          const stop = parseEPGDate(p.getAttribute("stop"));
          if (now >= start && now <= stop) {
            epgData[chan] = p.querySelector("title")?.textContent || "";
          }
        }
      } catch (error) {
        console.error("EPG verisi alınamadı:", error);
      }
    }

    function parseEPGDate(str) {
      if (!str) return new Date(0);
      const datePart = str.slice(0, 14);
      const tzPart = str.slice(15, 20);
      const y = +datePart.slice(0, 4), m = +datePart.slice(4, 6) - 1, d = +datePart.slice(6, 8);
      const h = +datePart.slice(8, 10), min = +datePart.slice(10, 12);
      const tzSign = tzPart[0] === '+' ? 1 : -1;
      const tzHours = +tzPart.slice(1, 3), tzMins = +tzPart.slice(3, 5);
      const offset = tzSign * (tzHours * 60 + tzMins) * 60000;
      const utcDate = new Date(Date.UTC(y, m, d, h, min));
      return new Date(utcDate.getTime() - offset);
    }

    function listGroups() {
      const desiredOrder = ['Tüm Kanallar', 'Ulusal', 'Spor', 'Çocuk & Eğitim', 'Belgesel', 'Müzik', 'Müzik Ekstra', 'Yaşam & Eğlence', 'Sinema ve Dizi', 'Ulusal Haber', 'Yabancı', 'Yabancı Haber'];
      let groups = [...new Set(allChannels.map(c => c.group))]
        .filter(g => g && g !== 'Bilgilendirme'); 

      groups.sort((a, b) => {
        const indexA = desiredOrder.indexOf(a);
        const indexB = desiredOrder.indexOf(b);
        if (indexA !== -1 && indexB !== -1) return indexA - indexB;
        if (indexA !== -1) return -1;
        if (indexB !== -1) return 1;
        return a.localeCompare(b);
      });

      G_UI.groups.innerHTML = "";
      groups.forEach((g) => {
        const el = document.createElement("div");
        el.className = "group";
        el.textContent = g;
        el.onclick = () => {
          document.querySelectorAll(".group").forEach(e => e.classList.remove("active"));
          el.classList.add("active");
          listChannels(g);
        };
        G_UI.groups.appendChild(el);
      });

      if (G_UI.groups.firstChild) G_UI.groups.firstChild.click();
    }

    function listChannels(group) {
      G_UI.channels.innerHTML = "";
      stopStream(G_UI.preview.video, hls);
      hls = null;
      G_UI.preview.video.style.display = 'none';
      G_UI.preview.placeholder.style.display = 'flex';
      
      currentChannelList = allChannels.filter(c => c.group === group);
      // Kanalları kendi içinde alfabetik sırala
      currentChannelList.sort((a, b) => a.name.localeCompare(b.name));

      currentChannelList.forEach((c, idx) => {
        const epgTitle = epgData[c.epgId] || "";
        const el = document.createElement("div");
        el.className = "channel";
        el.innerHTML = `<img src="${c.logo || ''}" onerror="this.style.display='none'" alt="logo">
        <div><div>${c.name}</div><div class="epg-title">${epgTitle}</div></div>`;
        el.onclick = () => {
            document.querySelectorAll(".channel.active").forEach(ch => ch.classList.remove("active"));
            el.classList.add("active");
            // idx'i global listedeki index ile eşleştir
            const globalIndex = allChannels.findIndex(chan => chan.name === c.name && chan.group === c.group);
            playChannelInPreview(globalIndex, idx); 
        };
        G_UI.channels.appendChild(el);
      });
    }

    function playChannelInPreview(globalIdx, localIdx) {
        currentChannelIndex = localIdx; // Yönlendirme butonları için yerel indexi kullan
        const channel = currentChannelList[localIdx];
        if (!channel) return;
        
        G_UI.player.logo.style.visibility = 'visible';
        G_UI.player.controls.forEach(btn => btn.style.visibility = 'visible');

        G_UI.player.logo.src = channel.logo || '';
        G_UI.preview.placeholder.style.display = 'none';
        G_UI.preview.video.style.display = 'block';

        playStream(G_UI.preview.video, channel.url, true).then(instance => hls = instance);
    }

    function changeChannel(direction) {
        if (currentChannelList.length === 0 || currentChannelIndex < 0) return;
        const newIndex = (currentChannelIndex + direction + currentChannelList.length) % currentChannelList.length;
        const channelElements = G_UI.channels.querySelectorAll('.channel');
        if(channelElements[newIndex]) {
            channelElements[newIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
            channelElements[newIndex].click();
        }
    }

    function toggleFullscreen() {
        if (currentChannelIndex < 0) return;

        if (!document.fullscreenElement) {
            G_UI.preview.video.requestFullscreen().catch(err => {
                alert(`Tam ekran modu hatası: ${err.message} (${err.name})`);
            });
        } else {
            document.exitFullscreen();
        }
    }
    
    async function playStream(videoElement, url, isUnmuted) {
        stopStream(videoElement, hls);
        
        if (Hls.isSupported()) {
            hls = new Hls();
            hls.loadSource(url);
            hls.attachMedia(videoElement);
        } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
            videoElement.src = url;
        } else {
            alert("Bu tarayıcı video oynatmayı desteklemiyor.");
            return null;
        }
        
        videoElement.muted = false;
        videoElement.volume = 1.0;
        
        try {
            await videoElement.play();
        } catch (err) {
            console.error("Otomatik oynatma (sesli) tarayıcı tarafından engellendi:", err);
        }
        return hls;
    }

    function stopStream(videoElement, hlsInstance) {
        videoElement.pause();
        videoElement.removeAttribute("src");
        try { videoElement.load(); } catch (e) {}
        if (hlsInstance) {
            hlsInstance.destroy();
        }
    }
    
    window.addEventListener("load", async () => {
      createThemeSelector();
      const savedTheme = localStorage.getItem('iptvTheme') || 'default';
      applyTheme(savedTheme);

      // 1. Tüm kaynaklardan kanalları al
      const m3uChannels = await fetchM3U();
      
      // 2. Tüm kanalları birleştir ve tekrarları kaldır (orijinal kategoriler korunur)
      const channelMap = new Map();
      const combinedList = [...m3uChannels, ...extraMusicChannels, ...newChannels];
      
      combinedList.forEach(channel => {
        const key = channel.name.trim().toLowerCase();
        channelMap.set(key, channel);
      });
      
      const uniqueCategorizedChannels = Array.from(channelMap.values());
      
      // 3. "Tüm Kanallar" kategorisi için kanalların bir kopyasını oluştur
      const allChannelsGroup = JSON.parse(JSON.stringify(uniqueCategorizedChannels));
      allChannelsGroup.forEach(channel => {
        channel.group = 'Tüm Kanallar';
      });
      
      // 4. "Tüm Kanallar" listesini ve kategorize edilmiş listeyi birleştir
      allChannels = [...allChannelsGroup, ...uniqueCategorizedChannels];
      
      await fetchEPG();
      listGroups();

      G_UI.preview.video.addEventListener('dblclick', toggleFullscreen);
    });
  </script>
</body>
</html>



